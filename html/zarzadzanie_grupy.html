<!doctype html>
<html lang="pl">
	<head>
		<script src="/js/jquery.min.js"></script>
		<script src="/js/main.js"></script>
		<script>
			setTimeout(function(){$('body').animate({opacity:'1'},500)},400);
			if (getCookie("token") == null) {
				document.location.href = "/logowanie.html";
				document.body.innerHTML = "";
				window.stop();
			} else {
				var userdata = {
					"id" : parseInt(getCookie("id")),
					"id_uprawnien" : parseInt(getCookie("id_uprawnienie"))
				}

				if (userdata.id_uprawnien < 1){ // minimalny poziom uprawnień (zabezpieczenie api osobno)
					document.location.href = "/";
					document.body.innerHTML = "";
					window.stop();
				}
			}
		</script>
		<meta charset="utf-8">
		<title>System obsługi studentów - zarządzanie grupami</title>
		<meta name="description" content="System Obsługi Studentów">
		<link rel="stylesheet" href="/css/navbar.css">
		<link rel="stylesheet" href="/css/main.css">
		<style>
            #kursy * {
                padding: 5px;
                border-right: 1px solid red;
                border-bottom: 1px solid red;
                border-left: 1px solid red;
            }

            #kursy {
				padding: 20px;
				border-radius: 10px;
				background-color: rgb(0, 73, 168, 0.6);
			}

            table#kursy td:nth-child(1) { /* id_zapisy */
                display: none;
            }
		</style>
	</head>
	<body>
		<div class="navbar">
			<a id="menu-strona" href="/">Strona główna</a>
			<div id="dropdown-wiadomosci" class="dropdown">
				<button class="dropbtn">
					<span>Wiadomości</span> 
					<i class="arrow down"></i>
				</button>
				<div class="dropdown-content">
					<a id="dropdown-wiadomosci-skrzynka" href="/wiadomosci.html"><span>Skrzynka odbiorcza</span></a>
					<a id="dropdown-wiadomosci-utworz" href="/wiadomosc_nowa.html"><span>Utwórz wiadomość</span></a>
				</div>
			</div>
			<a id="menu-ogloszenia" href="/ogloszenia.html">Zarządzanie ogłoszeniami</a>
			<div id="dropdown-uzytkownicy" class="dropdown">
				<button class="dropbtn">
					<span class="disabled">Zarządzanie użytkownikami</span> 
					<i class="arrow down"></i>
				</button>
				<div class="dropdown-content">
					<a id="dropdown-uzytkownicy-lista" href="#"><span class="disabled">Lista użytkowników</span></a>
					<a id="dropdown-uzytkownicy-utworz" href="#"><span class="disabled">Utwórz użytkownika</span></a>
				</div>
			</div>
			<a id="menu-zarzadzanie-zapisy" href="/zarzadzanie_zapisy.html">Zarządzanie zapisami</a>
			<a id="menu-zapisy" href="/"><span class="disabled">Zapisy</span></a>
			<a id="menu-zarzadzanie-kursy" href="/zarzadzanie_kursy.html">Zarządzanie kursami</a>
			<div id="dropdown-kursy" class="dropdown">
				<button class="dropbtn">
					<span class="disabled">Kursy</span>
					<i class="arrow down"></i>
				</button>
				<div class="dropdown-content">
					<a id="dropdown-kursy-zajecia" href="#"><span class="disabled">Zajęcia</span></a>
					<a id="dropdown-kursy-oceny" href="#"><span class="disabled">Oceny</span></a>
				</div>
			</div>
			<a id="menu-indeks" href="/"><span class="disabled">Indeks</span></a>
			<div id="dropdown-sprawy" class="dropdown">
				<button class="dropbtn">
					<span class="disabled">Sprawy</span>
					<i class="arrow down"></i>
				</button>
				<div class="dropdown-content">
					<a id="dropdown-sprawy-moje" href="#"><span class="disabled">Moje sprawy</span></a>
					<a id="dropdown-sprawy-utworz" href="#"><span class="disabled">Załóż sprawę</span></a>
				</div>
			</div>
			<div id="dropdown-sprawyz" class="dropdown">
				<button class="dropbtn">
					<span class="disabled">Zarządzaj sprawami</span>
					<i class="arrow down"></i>
				</button>
				<div class="dropdown-content">
					<a id="dropdown-sprawyz-lista" href="#"><span class="disabled">Przeglądaj sprawy</span></a>
					<a id="dropdown-sprawyz-utworz" href="#"><span class="disabled">Definiuj sprawy</span></a>
				</div>
			</div>
			<div class="dropdown-right">
				<button class="dropbtn">
					<span id="auth-imie">Imie</span> <span id="auth-nazwisko">Nazwisko</span> (<span id="auth-ranga">Ranga</span>)
					<i class="arrow down"></i>
				</button>
				<div class="dropdown-content">
					<a href="/dane_osobowe.html"><span>Dane osobowe</span></a>
					<a href="#"><span class="disabled">Ustawienia</span></a>
					<a id="wyloguj_navbar" href="/wyloguj.html">Wyloguj</a>
				</div>
			</div>
		</div>
		<div class="content">
			<div class="header">
				<h2>Zarządzanie grupami dla kursu <span style="color:red" id="nazwakursu">[NAZWA KURSU PLACEHOLDER]</span></h2>
			</div>

            <p style="color:red"><b>OSKRYPTOWAĆ</b></p>

            <button onclick="window.history.back();">Wróć</button>
            <button>Dodaj nową grupę</button></br></br>

            <p>Filtruj grupy dostępnością w zapisach:
                <select id="select-zapisy">
                    <option value="-1" selected>Nie filtruj</option>
                </select>
            </p>
            

            <table id="kursy">
                <tr>
                    <th>Kod grupy</th>
                    <th>Termin zajęć</th>
                    <th>Sala</th>
                    <th>Szczegóły kursu</th>
                    <th>Grupy dla kursu</th>
                </tr>
            </table>
		</div>

        <script>

            var id = getUrlParameter('id');

            if(id < 1){
                window.location.replace("/zarzadzanie_kursy.html");
            } else {

                $.ajax({
					url: '/api/zapisy',
					type: "POST",
					contentType: "application/json; charset=UTF-8",
					success: function (data) {
						console.log(data.status);
						console.log(data.result);
						
						if(data.status != 200){
							console.log("Wystąpił błąd!");
						} else if (data.status == 200){
							if (data.result.length > 0) {
							}
							for(let i = 0; i < data.result.length; i++){
								$("#select-zapisy").append(
									"<option value='"+data.result[i]['id']+"'>"+data.result[i]['nazwa']+"</option>"
								);
                        	}
						}
					}
			    });

                data_json = {
                    "id_kursu" : parseInt(id)
                }

                $.ajax({
					url: '/api/grupy',
					type: "POST",
                    data: JSON.stringify(data_json),
					contentType: "application/json; charset=UTF-8",
					success: function (data) {
						console.log(data.status);
						console.log(data.result);
						
						if(data.status != 200){
							console.log("Wystąpił błąd!");
						} else if (data.status == 200){
							if (data.result.length > 0) {
							}
							for(let i = 0; i < data.result.length; i++){
								$("#kursy").append(
									"<tr>"+
                                        "<td>"+data.result[i]['id_zapisy']+"</td>"+
										"<td>"+data.result[i]['kod_grupy']+"</td>"+
										"<td>"+data.result[i]['termin']+"</td>"+
                                        "<td>"+data.result[i]['sala']+"</td>"+
                                        "<td><button onclick='pokaz_szczegoly("+data.result[i]['id']+")'>SZCZEGÓŁY</button></td>"+
                                        "<td><button onclick='pokaz_uczestnikow("+data.result[i]['id']+")'>UCZESTNICY</button></td>"+
									"</tr>"
								);
                        	}
						}
					}
			    });
            }

            function pokaz_szczegoly(id){
                alert(id);
            }

            function pokaz_uczestnikow(id){
                window.location.href = "/zarzadzanie_grupy_uczestnicy.html?id="+id;
            }    
		</script>
		<script src="/js/nav.js"></script>
	</body>
</html>